<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>TRT Estimator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        const MIN_TRT = {{ min_trt | tojson }};
        const MAX_TRT = {{ max_trt | tojson }};
    </script>      
</head>

<body>

    <h1>TRT Estimator</h1>

    <form method="POST" onsubmit="showLoading()">
        <textarea name="input_text" rows="5" placeholder="Enter your text here">{{ input_text }}</textarea>
        <button type="submit">Estimate TRT</button>
    </form>

    <div id="loading">
        <span class="spinner"></span> Computing TRT...
    </div>

    {% if results %}
    {% set min_trt = results | map(attribute='trt') | min %}
    {% set max_trt = results | map(attribute='trt') | max %}

    <div class="results">
        <h3>Results:</h3>

        <!-- Read-only heatmap -->
        <div class="heatmap-readonly" style="margin-top:1rem;">
            <p style="line-height:2rem; font-size:1.1rem;">
                {% for item in results %}
                {% set norm = (item.trt - min_trt)/(max_trt-min_trt+1e-5) %}
                {% set hue = 120 - (norm*120) %}
                <span class="word-tooltip" style="background-color:hsl({{hue}},80%,85%);
                         padding:2px 4px; margin:2px; border-radius:4px; display:inline-block;">
                    {{ item.word }}
                    <span class="tooltip-text">TRT: {{ item.trt }} ms</span>
                </span>
                {% endfor %}
            </p>
        </div>

        <!-- Clickable heatmap for simplification -->
        <div class="simplify-section" style="margin-top:2rem;">
            <h4>Click a word to simplify:</h4>
            <p id="simplify-heatmap" style="line-height:2rem; font-size:1.1rem;">
                {% for item in results %}
                {% set norm = (item.trt - min_trt)/(max_trt-min_trt+1e-5) %}
                {% set hue = 120 - (norm*120) %}
                <span class="word-tooltip simplify-word" data-idx="{{ loop.index0 }}" data-trt="{{ item.trt }}"
                    data-sentence="{{ input_text|e }}" style="background-color:hsl({{hue}},80%,85%);
                     padding:2px 4px; margin:2px; border-radius:4px;
                     display:inline-block; cursor:pointer;">
                    <span class="word-text">{{ item.word }}</span>
                    <span class="tooltip-text">TRT: {{ item.trt }} ms</span>
                    <span class="inline-spinner"></span>
                </span>
                {% endfor %}
            </p>
        </div>

        <!-- Word list -->
        {% for item in results %}
        <div class="word-box">
            <strong>{{ item.word }}</strong>: {{ item.trt }} ms
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>